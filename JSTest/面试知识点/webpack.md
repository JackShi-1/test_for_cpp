### æŒæ¡ Webpack

#### 1. å®‰è£… Webpack

åœ¨é¡¹ç›®ä¸­å®‰è£… Webpack å’Œ Webpack CLIï¼š

```bash
npm install webpack webpack-cli --save-dev
```

#### 2. é…ç½® Webpack

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `webpack.config.js` æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é…ç½®ç¤ºä¾‹ï¼š

```javascript
const path = require("path");

module.exports = {
  entry: "./src/index.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "bundle.js",
  },
};
```

#### 3. ç¼–å†™å…¥å£æ–‡ä»¶

åœ¨é¡¹ç›®ä¸­åˆ›å»º `src` ç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º `index.js` æ–‡ä»¶ï¼Œç¼–å†™ä¸€äº›ä»£ç ï¼š

```javascript
const message = "Hello, Webpack!";
console.log(message);
```

#### 4. è¿è¡Œ Webpack

åœ¨ `package.json` çš„ `scripts` ä¸­æ·»åŠ ä¸€ä¸ªè„šæœ¬ï¼š

```json
{
  "scripts": {
    "build": "webpack"
  }
}
```

ç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼š

```bash
npm run build
```

Webpack ä¼šæ ¹æ®é…ç½®æ–‡ä»¶å°† `src/index.js` æ‰“åŒ…åˆ° `dist/bundle.js` ä¸­ã€‚

#### 5. å­¦ä¹  Webpack åŠ è½½å™¨å’Œæ’ä»¶

Webpack å¯ä»¥ä½¿ç”¨åŠ è½½å™¨ï¼ˆLoaderï¼‰å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚ CSSã€å›¾ç‰‡ç­‰ï¼Œä½¿ç”¨æ’ä»¶ï¼ˆPluginï¼‰æ‰©å±•åŠŸèƒ½ï¼Œå¦‚ä»£ç å‹ç¼©ã€åˆ†å‰²ä»£ç ç­‰ã€‚ä¾‹å¦‚ï¼Œå®‰è£…å¹¶é…ç½® `style-loader` å’Œ `css-loader` æ¥å¤„ç† CSS æ–‡ä»¶ï¼š

```bash
npm install style-loader css-loader --save-dev
```

åœ¨ `webpack.config.js` ä¸­æ·»åŠ åŠ è½½å™¨é…ç½®ï¼š

```javascript
module.exports = {
  // ... å…¶ä»–é…ç½®
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ["style-loader", "css-loader"],
      },
    ],
  },
};
```

---

### 6. Webpack

> `webpack`æ˜¯ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œä»–çš„å®—æ—¨æ˜¯ä¸€åˆ‡é™æ€èµ„æºçš†å¯æ‰“åŒ…ã€‚

- ä¸ºä»€ä¹ˆè¦ webpackï¼Ÿ
  - webpack æ˜¯ç°ä»£å‰ç«¯æŠ€æœ¯çš„åŸºçŸ³ï¼Œå¸¸è§„çš„å¼€å‘æ–¹å¼ï¼Œæ¯”å¦‚ jquery,html,css é™æ€ç½‘é¡µå¼€å‘å·²ç»è½åäº†ã€‚
  - ç°åœ¨æ˜¯ MVVM çš„æ—¶ä»£ï¼Œæ•°æ®é©±åŠ¨ç•Œé¢ã€‚webpack å®ƒåšçš„äº‹æƒ…æ˜¯ï¼Œåˆ†æä½ çš„é¡¹ç›®ç»“æ„ï¼Œæ‰¾åˆ° JavaScript æ¨¡å—ä»¥åŠå…¶å®ƒçš„ä¸€äº›æµè§ˆå™¨ä¸èƒ½ç›´æ¥è¿è¡Œçš„æ‹“å±•è¯­è¨€ï¼ˆScssï¼ŒTypeScript ç­‰ï¼‰ï¼Œå¹¶å°†å…¶æ‰“åŒ…ä¸ºåˆé€‚çš„æ ¼å¼ä»¥ä¾›æµè§ˆå™¨ä½¿ç”¨ã€‚

#### 6.1 webpack æ ¸å¿ƒæ¦‚å¿µ

æ¨¡å—åŒ–ï¼šWebpack å°†é¡¹ç›®ä¸­çš„å„ç§æ–‡ä»¶ï¼ˆåŒ…æ‹¬ JavaScriptã€CSSã€å›¾ç‰‡ç­‰ï¼‰éƒ½è§†ä½œæ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯ä»¥ç›¸äº’ä¾èµ–ã€å¼•ç”¨ï¼Œå¹¶é€šè¿‡ loader è¿›è¡Œå¤„ç†ã€‚å®ƒæ”¯æŒå¤šç§æ¨¡å—åŒ–è§„èŒƒï¼ˆå¦‚ CommonJSã€AMDã€ES Modules ç­‰ï¼‰ï¼Œèƒ½å¤Ÿå°†ä¸åŒç±»å‹çš„èµ„æºéƒ½è§†ä½œæ¨¡å—è¿›è¡Œå¤„ç†å’Œç®¡ç†

1. **Entryï¼ˆå…¥å£ï¼‰**ï¼šæŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚è¿›å…¥å…¥å£èµ·ç‚¹åï¼Œwebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„ã€‚
2. **Outputï¼ˆå‡ºå£ï¼‰**ï¼šå‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ç»“æœæ–‡ä»¶ï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ï¼Œé»˜è®¤å€¼ä¸º./distã€‚
3. Loaderï¼ˆæ¨¡å—è½¬æ¢å™¨ï¼‰ï¼šå°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—ï¼Œç„¶åä½ å°±å¯ä»¥åˆ©ç”¨ webpack çš„æ‰“åŒ…èƒ½åŠ›ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ã€‚
   Webpack é€šè¿‡ Loader æ¥å¤„ç†é JavaScript æ–‡ä»¶ï¼Œæ¯”å¦‚å¤„ç† CSSã€å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºæ–‡ä»¶ï¼Œå°†å®ƒä»¬è½¬æ¢æˆæ¨¡å—å¯ä»¥ç›´æ¥å¼•ç”¨çš„å½¢å¼ã€‚Loader å…è®¸å¼€å‘è€…åœ¨æ„å»ºè¿‡ç¨‹ä¸­é¢„å¤„ç†æ–‡ä»¶ï¼Œä¾‹å¦‚ä½¿ç”¨ Babel å¤„ç† ES6+ è¯­æ³•ã€ä½¿ç”¨ PostCSS å¤„ç† CSSã€å‹ç¼©å›¾ç‰‡ç­‰
4. Pluginsï¼ˆæ’ä»¶ï¼‰ï¼šåœ¨ Webpack æ„å»ºæµç¨‹ä¸­çš„ç‰¹å®šæ—¶æœºæ³¨å…¥æ‰©å±•é€»è¾‘æ¥æ”¹å˜æ„å»ºç»“æœæˆ–åšä½ æƒ³è¦çš„äº‹æƒ…ã€‚é€šè¿‡å„ç§æ’ä»¶æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œä¼˜åŒ–æ–¹å¼ï¼Œä¾‹å¦‚å‹ç¼©ä»£ç ã€ä»£ç åˆ†å‰²ã€èµ„æºä¼˜åŒ–ã€ç¯å¢ƒå˜é‡æ³¨å…¥ç­‰
5. **Module(æ¨¡å—)**ï¼šå¼€å‘è€…å°†ç¨‹åºåˆ†è§£æˆç¦»æ•£åŠŸèƒ½å—ï¼Œå¹¶ç§°ä¹‹ä¸ºæ¨¡å—ï¼Œåœ¨ webpack é‡Œä¸€ä¸ªæ¨¡å—å¯¹åº”ç€ä¸€ä¸ªæ–‡ä»¶ï¼Œwebpack ä¼šä»é…ç½®çš„ Entry å¼€å§‹é€’å½’æ‰¾å‡ºæ‰€æœ‰ä¾èµ–çš„æ¨¡å—ã€‚

#### 6.2 Webpack æ‰§è¡Œæµç¨‹

- webpack å¯åŠ¨åä¼šåœ¨ entry é‡Œé…ç½®çš„ module å¼€å§‹é€’å½’è§£æ entry æ‰€ä¾èµ–çš„æ‰€æœ‰ moduleï¼Œ
- æ¯æ‰¾åˆ°ä¸€ä¸ª module, å°±ä¼šæ ¹æ®é…ç½®çš„ loader å»æ‰¾ç›¸åº”çš„è½¬æ¢è§„åˆ™ï¼Œå¯¹ module è¿›è¡Œè½¬æ¢ååœ¨è§£æå½“å‰ module æ‰€ä¾èµ–çš„ moduleï¼Œè¿™äº›æ¨¡å—ä¼šä»¥ entry ä¸ºåˆ†ç»„ï¼Œä¸€ä¸ª entry å’Œæ‰€æœ‰ç›¸ä¾èµ–çš„ module ä¹Ÿå°±æ˜¯ä¸€ä¸ª chunkï¼Œ
- æœ€å webpack ä¼šæŠŠæ‰€æœ‰ chunk è½¬æ¢æˆæ–‡ä»¶è¾“å‡ºï¼Œåœ¨æ•´ä¸ªæµç¨‹ä¸­ webpack ä¼šåœ¨æ°å½“çš„æ—¶æœºæ‰§è¡Œ plugin çš„é€»è¾‘

#### 6.3 å¦‚ä½•æâ¾¼ webpack çš„æ‰“åŒ…é€Ÿåº¦?

##### 1. ä¼˜åŒ– Loader

> ğŸŒ°: Babel ä¼šå°†ä»£ç è½¬ä¸ºå­—ç¬¦ä¸²ç”Ÿæˆ ASTï¼Œç„¶åå¯¹ AST ç»§ç»­è¿›è¡Œè½¬å˜æœ€åå†ç”Ÿæˆæ–°çš„ä»£ç ï¼Œé¡¹ç›®è¶Šå¤§ï¼Œè½¬æ¢ä»£ç è¶Šå¤šï¼Œæ•ˆç‡å°±è¶Šä½ã€‚å½“ç„¶äº†ï¼Œè¿™æ˜¯å¯ä»¥ä¼˜åŒ–çš„

1.  ä¼˜åŒ– `Loader` çš„æ–‡ä»¶æœç´¢èŒƒå›´
2.  å°† `Babel` ç¼–è¯‘è¿‡çš„æ–‡ä»¶**ç¼“å­˜**èµ·æ¥

##### 2. HappyPack

- `Webpack` åœ¨æ‰“åŒ…çš„è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å•çº¿ç¨‹çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨æ‰§è¡Œ `Loader` çš„æ—¶å€™ï¼Œé•¿æ—¶é—´ç¼–è¯‘çš„ä»»åŠ¡å¾ˆå¤šï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ç­‰å¾…çš„æƒ…å†µ
- `HappyPack` å¯ä»¥å°† `Loader` çš„åŒæ­¥æ‰§è¡Œè½¬æ¢ä¸ºå¹¶è¡Œçš„ï¼Œè¿™æ ·å°±èƒ½å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºæ¥åŠ å¿«æ‰“åŒ…æ•ˆç‡äº†

##### 3. DllPlugin

`DllPlugin` å¯ä»¥å°†ç‰¹å®šçš„ç±»åº“æå‰æ‰“åŒ…ç„¶åå¼•å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥æå¤§çš„å‡å°‘æ‰“åŒ…ç±»åº“çš„æ¬¡æ•°ï¼Œåªæœ‰å½“ç±»åº“æ›´æ–°ç‰ˆæœ¬æ‰æœ‰éœ€è¦é‡æ–°æ‰“åŒ…ï¼Œå¹¶ä¸”ä¹Ÿå®ç°äº†å°†å…¬å…±ä»£ç æŠ½ç¦»æˆå•ç‹¬æ–‡ä»¶çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚

##### 4. ä»£ç å‹ç¼©

- `Webpack3`: ä¸€èˆ¬ä½¿ç”¨ `UglifyJS` æ¥å‹ç¼©ä»£ç ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯å•çº¿ç¨‹è¿è¡Œçš„ï¼Œä¸ºäº†åŠ å¿«æ•ˆç‡ï¼Œå¯ä»¥ä½¿ç”¨ webpack-parallel-uglify-plugin æ¥å¹¶è¡Œè¿è¡Œ UglifyJSï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚
- `Webpack4` ä¸­ï¼Œmode => production å°±å¯ä»¥é»˜è®¤å¼€å¯ä»¥ä¸ŠåŠŸèƒ½ã€‚ä»£ç å‹ç¼©ä¹Ÿæ˜¯æˆ‘ä»¬å¿…åšçš„æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼Œå½“ç„¶æˆ‘ä»¬ä¸æ­¢å¯ä»¥å‹ç¼© JS ä»£ç ï¼Œè¿˜å¯ä»¥å‹ç¼© HTMLã€CSS ä»£ç ï¼Œå¹¶ä¸”åœ¨å‹ç¼© JS ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡é…ç½®å®ç°æ¯”å¦‚åˆ é™¤ console.log è¿™ç±»ä»£ç çš„åŠŸèƒ½ã€‚

##### å…¶ä»–

å¯ä»¥é€šè¿‡ä¸€äº›å°çš„ä¼˜åŒ–ç‚¹æ¥åŠ å¿«æ‰“åŒ…é€Ÿåº¦

- resolve.extensionsï¼šç”¨æ¥è¡¨æ˜æ–‡ä»¶åç¼€åˆ—è¡¨ï¼Œé»˜è®¤æŸ¥æ‰¾é¡ºåºæ˜¯ ['.js', '.json']ï¼Œå¦‚æœä½ çš„å¯¼å…¥æ–‡ä»¶æ²¡æœ‰æ·»åŠ åç¼€å°±ä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºæŸ¥æ‰¾æ–‡ä»¶ã€‚æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½å‡å°‘åç¼€åˆ—è¡¨é•¿åº¦ï¼Œç„¶åå°†å‡ºç°é¢‘ç‡é«˜çš„åç¼€æ’åœ¨å‰é¢
- resolve.aliasï¼šå¯ä»¥é€šè¿‡åˆ«åçš„æ–¹å¼æ¥æ˜ å°„ä¸€ä¸ªè·¯å¾„ï¼Œèƒ½è®© Webpack æ›´å¿«æ‰¾åˆ°è·¯å¾„
- module.noParseï¼šå¦‚æœä½ ç¡®å®šä¸€ä¸ªæ–‡ä»¶ä¸‹æ²¡æœ‰å…¶ä»–ä¾èµ–ï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥å±æ€§è®© Webpack ä¸æ‰«æè¯¥æ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼å¯¹äºå¤§å‹çš„ç±»åº“å¾ˆæœ‰å¸®åŠ©

1.  ä½¿ç”¨åˆé€‚çš„ Loader å’Œ Pluginï¼š
    Loaderï¼š ç¡®ä¿ä½¿ç”¨æœ€è½»é‡çº§çš„ Loader æ¥å¤„ç†æ–‡ä»¶ï¼Œé¿å…ä¸å¿…è¦çš„è½¬æ¢å’Œå¤„ç†ã€‚
    Pluginï¼š åªä½¿ç”¨å¿…è¦çš„æ’ä»¶ï¼Œé¿å…è¿‡å¤šçš„æ’ä»¶é…ç½®ã€‚
2.  ç¼©å°æ–‡ä»¶æœç´¢èŒƒå›´ï¼š
    resolve é…ç½®ï¼š åœ¨ Webpack é…ç½®ä¸­ä½¿ç”¨ resolve é…ç½®é¡¹ï¼Œç¼©å°æ¨¡å—æœç´¢èŒƒå›´ã€‚
    exclude/include é…ç½®ï¼š åœ¨ Loader é…ç½®ä¸­ä½¿ç”¨ exclude å’Œ include æ¥ç¼©å° Loader å¤„ç†çš„æ–‡ä»¶èŒƒå›´ã€‚
3.  ä½¿ç”¨ DllPlugin æå‰æ‰“åŒ…ï¼š
    ä½¿ç”¨ DllPlugin é¢„å…ˆæ‰“åŒ…ç¬¬ä¸‰æ–¹åº“ï¼Œå‡å°‘æ‰“åŒ…æ—¶é—´ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚
4.  å¼€å¯ç¼“å­˜ï¼š
    ä½¿ç”¨ç¼“å­˜ï¼ˆcacheï¼‰ï¼šå¼€å¯ Webpack çš„ç¼“å­˜åŠŸèƒ½ï¼Œå¯ä»¥å‡å°‘æ„å»ºæ—¶é—´ã€‚
    ä½¿ç”¨ hard-source-webpack-plugin ç­‰æ’ä»¶ï¼Œå°†æ¨¡å—ç¼“å­˜åˆ°ç£ç›˜ï¼Œæé«˜äºŒæ¬¡æ„å»ºé€Ÿåº¦ã€‚
5.  å¤šçº¿ç¨‹/å¹¶è¡Œæ„å»ºï¼š
    ä½¿ç”¨ HappyPack æˆ– thread-loader ç­‰æ’ä»¶ï¼Œå®ç°å¤šçº¿ç¨‹æˆ–å¹¶è¡Œæ„å»ºï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚
6.  ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½ï¼š
    ä½¿ç”¨ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰å’Œæ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šèµ„æºã€‚
7.  Tree Shakingï¼š
    å¼€å¯ Tree Shakingï¼Œåˆ é™¤æœªä½¿ç”¨çš„ä»£ç ï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯å’Œæ„å»ºæ—¶é—´ã€‚
8.  å‡å°‘æ¨¡å—æ•°é‡ï¼š
    å°½å¯èƒ½å‡å°‘ä¸å¿…è¦çš„æ¨¡å—ä¾èµ–ï¼Œé¿å…æ„å»ºè¿‡å¤šçš„æ¨¡å—ã€‚
9.  å‡çº§ Webpackï¼š
    ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Webpackï¼Œæ–°ç‰ˆæœ¬é€šå¸¸ä¼šæœ‰æ€§èƒ½ä¼˜åŒ–å’Œæ”¹è¿›ã€‚
10. ç›‘æ§æ„å»ºæ—¶é—´ï¼š
    ä½¿ç”¨ Webpack Bundle Analyzer ç­‰å·¥å…·ï¼Œåˆ†ææ„å»ºäº§ç‰©ï¼Œæ‰¾å‡ºä½“ç§¯è¾ƒå¤§çš„æ¨¡å—æˆ–åº“ï¼Œä¼˜åŒ–æ‰“åŒ…ç­–ç•¥ã€‚
    è¿™äº›ä¼˜åŒ–æªæ–½å¯ä»¥æ ¹æ®å…·ä½“é¡¹ç›®éœ€æ±‚è¿›è¡Œé€‰æ‹©å’Œç»„åˆï¼Œç»¼åˆåˆ©ç”¨å¯ä»¥æ˜¾è‘—æå‡ Webpack çš„æ„å»ºé€Ÿåº¦ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

#### 6.4 å¦‚ä½•å‡å°‘ `Webpack` æ‰“åŒ…ä½“ç§¯

1. æŒ‰éœ€åŠ è½½
   > å¯ä»¥ä½¿ç”¨æŒ‰éœ€åŠ è½½ï¼Œå°†æ¯ä¸ªè·¯ç”±é¡µé¢å•ç‹¬æ‰“åŒ…ä¸ºä¸€ä¸ªæ–‡ä»¶
2. `Scope Hoisting`
   > `Scope Hoisting` ä¼šåˆ†æå‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå°½å¯èƒ½çš„æŠŠæ‰“åŒ…å‡ºæ¥çš„æ¨¡å—åˆå¹¶åˆ°ä¸€ä¸ªå‡½æ•°ä¸­å»
   > wp4: `optimization.concatenateModules`è®¾ç½®ä¸º`true`
3. Tree Shaking
   > å®ç°åˆ é™¤é¡¹ç›®ä¸­æœªè¢«å¼•ç”¨çš„ä»£ç 

#### 6.5 å¦‚ä½•â½¤ webpack æ¥ä¼˜åŒ–å‰ç«¯æ€§èƒ½ï¼Ÿ

> â½¤ webpack ä¼˜åŒ–å‰ç«¯æ€§èƒ½æ˜¯æŒ‡ä¼˜åŒ– webpack çš„è¾“å‡ºç»“æœï¼Œè®©æ‰“åŒ…çš„æœ€ç»ˆç»“æœåœ¨æµè§ˆå™¨è¿â¾å¿«é€Ÿâ¾¼æ•ˆã€‚

- å‹ç¼©ä»£ç ï¼šåˆ é™¤å¤šä½™çš„ä»£ç ã€æ³¨é‡Šã€ç®€åŒ–ä»£ç çš„å†™æ³•ç­‰ç­‰â½…å¼ã€‚å¯ä»¥åˆ©â½¤ webpack çš„ UglifyJsPlugin å’Œ ParallelUglifyPlugin æ¥å‹ç¼© JS â½‚ä»¶ï¼Œ åˆ©â½¤ cssnano ï¼ˆcss-loader?minimizeï¼‰æ¥å‹ç¼© css
- åˆ©â½¤ CDN åŠ é€Ÿ: åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå°†å¼•â½¤çš„é™æ€èµ„æºè·¯å¾„ä¿®æ”¹ä¸º CDN ä¸Šå¯¹åº”çš„è·¯å¾„ã€‚å¯ä»¥åˆ©â½¤ webpack å¯¹äº output å‚æ•°å’Œå„ loader çš„ publicPath å‚æ•°æ¥ä¿®æ”¹èµ„æºè·¯å¾„
- Tree Shaking: å°†ä»£ç ä¸­æ°¸è¿œä¸ä¼šâ¾›åˆ°çš„â½šæ®µåˆ é™¤æ‰ã€‚å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨ webpack æ—¶è¿½åŠ å‚æ•° --optimize-minimize æ¥å®ç°
- Code Splitting: å°†ä»£ç æŒ‰è·¯ç”±ç»´åº¦æˆ–è€…ç»„ä»¶åˆ†å—(chunk),è¿™æ ·åšåˆ°æŒ‰éœ€åŠ è½½,åŒæ—¶å¯ä»¥å……åˆ†åˆ©â½¤æµè§ˆå™¨ç¼“å­˜
- æå–å…¬å…±ç¬¬ä¸‰â½…åº“: `SplitChunksPlugin`æ’ä»¶æ¥è¿›â¾å…¬å…±æ¨¡å—æŠ½å–,åˆ©â½¤æµè§ˆå™¨ç¼“å­˜å¯ä»¥â»“æœŸç¼“å­˜è¿™äº›â½†éœ€é¢‘ç¹å˜åŠ¨çš„å…¬å…±ä»£ç 

#### 6.6 å¦‚ä½•æâ¾¼ webpack çš„æ„å»ºé€Ÿåº¦ï¼Ÿ

1. å¤šâ¼Šâ¼æƒ…å†µä¸‹ï¼Œä½¿â½¤ `CommonsChunkPlugin` æ¥æå–å…¬å…±ä»£ç 
2. é€šè¿‡ `externals` é…ç½®æ¥æå–å¸¸â½¤åº“
3. åˆ©â½¤ `DllPlugin` å’Œ `DllReferencePlugin` é¢„ç¼–è¯‘èµ„æºæ¨¡å— é€šè¿‡ `DllPlugin` æ¥å¯¹é‚£äº›æˆ‘ä»¬å¼•â½¤ä½†æ˜¯ç»å¯¹ä¸ä¼šä¿®æ”¹çš„ npm åŒ…æ¥è¿›â¾é¢„ç¼–è¯‘ï¼Œå†é€šè¿‡ `DllReferencePlugin` å°†é¢„ç¼–è¯‘çš„æ¨¡å—åŠ è½½è¿›æ¥ã€‚
4. ä½¿â½¤ `Happypack` å®ç°å¤šçº¿ç¨‹åŠ é€Ÿç¼–è¯‘
5. ä½¿â½¤ `webpack-uglify-parallel` æ¥æå‡ `uglifyPlugin` çš„å‹ç¼©é€Ÿåº¦ã€‚ åŸç†ä¸Š `webpack-uglify-parallel` é‡‡â½¤äº†å¤šæ ¸å¹¶â¾å‹ç¼©æ¥æå‡å‹ç¼©é€Ÿåº¦
6. ä½¿â½¤ `Tree-shaking` å’Œ `Scope Hoisting` æ¥å‰”é™¤å¤šä½™ä»£ç 

---

# å¦‚ä½•å†™ä¸€ä¸ª webpack æ’ä»¶

Webpack æ’ä»¶æ˜¯ä¸€ä¸ªå…·æœ‰ `apply` æ–¹æ³•çš„ JavaScript å¯¹è±¡ï¼Œ`apply` æ–¹æ³•ä¼šåœ¨ Webpack ç¼–è¯‘å™¨ï¼ˆcompilerï¼‰å®ä¾‹åŒ–æ—¶è¢«è°ƒç”¨ï¼Œå¹¶æ¥æ”¶ç¼–è¯‘å™¨å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ä»¥ä¸‹æ˜¯ç¼–å†™ä¸€ä¸ª Webpack æ’ä»¶çš„è¯¦ç»†æ­¥éª¤å’Œç¤ºä¾‹ï¼š

### 1. ç†è§£ Webpack æ’ä»¶çš„åŸºæœ¬æ¦‚å¿µ

Webpack æ’ä»¶é€šè¿‡ç›‘å¬ Webpack ç¼–è¯‘å™¨çš„å„ç§é’©å­ï¼ˆhooksï¼‰æ¥æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚é’©å­æ˜¯ Webpack æä¾›çš„ä¸€äº›äº‹ä»¶ï¼Œå…è®¸æ’ä»¶åœ¨ç¼–è¯‘è¿‡ç¨‹çš„ä¸åŒé˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚

### 2. åˆ›å»ºæ’ä»¶æ–‡ä»¶

é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ JavaScript æ–‡ä»¶æ¥å®šä¹‰æ’ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹ï¼Œç”¨äºåœ¨ç¼–è¯‘å®Œæˆåè¾“å‡ºä¸€æ¡è‡ªå®šä¹‰æ¶ˆæ¯ï¼š

```javascript
// MyWebpackPlugin.js
class MyWebpackPlugin {
  // æ„é€ å‡½æ•°ï¼Œå¯ç”¨äºæ¥æ”¶æ’ä»¶é…ç½®å‚æ•°
  constructor(options) {
    this.options = options;
  }

  // apply æ–¹æ³•æ˜¯æ’ä»¶çš„æ ¸å¿ƒï¼Œä¼šåœ¨ Webpack ç¼–è¯‘å™¨å®ä¾‹åŒ–æ—¶è¢«è°ƒç”¨
  apply(compiler) {
    // ç›‘å¬ compilation é’©å­ï¼Œè¯¥é’©å­åœ¨ç¼–è¯‘å¼€å§‹æ—¶è§¦å‘
    compiler.hooks.compile.tap("MyWebpackPlugin", () => {
      console.log("Compilation is starting...");
    });

    // ç›‘å¬ done é’©å­ï¼Œè¯¥é’©å­åœ¨ç¼–è¯‘å®Œæˆæ—¶è§¦å‘
    compiler.hooks.done.tap("MyWebpackPlugin", (stats) => {
      if (this.options && this.options.message) {
        console.log(this.options.message);
      } else {
        console.log("Compilation is done!");
      }
    });
  }
}

module.exports = MyWebpackPlugin;
```

### 3. åœ¨ Webpack é…ç½®ä¸­ä½¿ç”¨æ’ä»¶

åœ¨ `webpack.config.js` æ–‡ä»¶ä¸­å¼•å…¥å¹¶ä½¿ç”¨åˆšåˆšåˆ›å»ºçš„æ’ä»¶ï¼š

```javascript
const path = require("path");
const MyWebpackPlugin = require("./MyWebpackPlugin");

module.exports = {
  entry: "./src/index.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "bundle.js",
  },
  plugins: [
    // å®ä¾‹åŒ–æ’ä»¶å¹¶ä¼ å…¥é…ç½®å‚æ•°
    new MyWebpackPlugin({
      message: "Custom compilation done message!",
    }),
  ],
};
```

### 4. è¯¦ç»†è§£é‡Š

- **ç±»å®šä¹‰**ï¼šåˆ›å»ºä¸€ä¸ª JavaScript ç±»ï¼Œç±»åå³ä¸ºæ’ä»¶åã€‚åœ¨ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œå¯ä»¥æ¥æ”¶æ’ä»¶çš„é…ç½®å‚æ•°ã€‚
- **`apply` æ–¹æ³•**ï¼šè¿™æ˜¯æ’ä»¶çš„æ ¸å¿ƒæ–¹æ³•ï¼ŒWebpack ç¼–è¯‘å™¨ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ `compiler` å¯¹è±¡ã€‚`compiler` å¯¹è±¡ä»£è¡¨äº†æ•´ä¸ª Webpack ç¼–è¯‘è¿‡ç¨‹ï¼ŒåŒ…å«äº†è®¸å¤šé’©å­ï¼ˆhooksï¼‰ï¼Œå¯ä»¥é€šè¿‡ç›‘å¬è¿™äº›é’©å­æ¥æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚
- **é’©å­ç›‘å¬**ï¼šä½¿ç”¨ `compiler.hooks.<hookName>.tap` æ–¹æ³•æ¥ç›‘å¬ç‰¹å®šçš„é’©å­ã€‚`hookName` æ˜¯ Webpack æä¾›çš„é’©å­åç§°ï¼Œ`tap` æ–¹æ³•ç”¨äºæ³¨å†Œä¸€ä¸ªåŒæ­¥é’©å­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ’ä»¶åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨é’©å­è§¦å‘æ—¶æ‰§è¡Œã€‚

### 5. æ›´å¤šå¤æ‚ç¤ºä¾‹ï¼šç”Ÿæˆæ–‡ä»¶æ’ä»¶

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œç”¨äºåœ¨ç¼–è¯‘å®Œæˆåç”Ÿæˆä¸€ä¸ªè‡ªå®šä¹‰çš„æ–‡ä»¶ï¼š

```javascript
// GenerateFilePlugin.js
const fs = require("fs");
const path = require("path");

class GenerateFilePlugin {
  constructor(options) {
    this.options = options;
  }

  apply(compiler) {
    compiler.hooks.done.tap("GenerateFilePlugin", () => {
      const outputPath = path.resolve(
        compiler.options.output.path,
        this.options.filename
      );
      const content = this.options.content || "This is a generated file.";

      fs.writeFile(outputPath, content, (err) => {
        if (err) {
          console.error("Error generating file:", err);
        } else {
          console.log(`File ${this.options.filename} generated successfully.`);
        }
      });
    });
  }
}

module.exports = GenerateFilePlugin;
```

åœ¨ `webpack.config.js` ä¸­ä½¿ç”¨è¯¥æ’ä»¶ï¼š

```javascript
const path = require("path");
const GenerateFilePlugin = require("./GenerateFilePlugin");

module.exports = {
  entry: "./src/index.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "bundle.js",
  },
  plugins: [
    new GenerateFilePlugin({
      filename: "generated.txt",
      content: "Hello, this is a custom generated file!",
    }),
  ],
};
```

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ç¼–å†™å„ç§åŠŸèƒ½çš„ Webpack æ’ä»¶ï¼Œå®ç°å¯¹ Webpack ç¼–è¯‘è¿‡ç¨‹çš„å®šåˆ¶åŒ–æ§åˆ¶ã€‚
